<div class="product-page">
  <div class="container">
    <div class="product-page__grid">

      <!-- Product Images -->
      <div class="product-page__images">
        <div class="product-page__main-image">
          {% if product.featured_image %}
            <img src="{{ product.featured_image | img_url: '1000x' }}"
                 alt="{{ product.title }}"
                 loading="eager"
                 id="product-main-image">
          {% else %}
            {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
          {% endif %}
        </div>

        {% if product.images.size > 1 %}
          <div class="product-page__thumbnails">
            {% for image in product.images %}
              <button class="product-page__thumbnail{% if forloop.first %} active{% endif %}"
                      data-image-src="{{ image | img_url: '1000x' }}">
                <img src="{{ image | img_url: '150x' }}" alt="{{ product.title }}">
              </button>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <!-- Product Info -->
      <div class="product-page__info">
        <h1 class="product-page__title h2">{{ product.title }}</h1>

        <div class="product-page__price">
          {% if product.compare_at_price > product.price %}
            <span class="product-page__price-compare">{{ product.compare_at_price | money }}</span>
          {% endif %}
          <span class="product-page__price-current" id="product-price">{{ product.selected_or_first_available_variant.price | money }}</span>
        </div>

        <div class="product-page__description rte">
          {{ product.description }}
        </div>

        <!-- Product Form -->
        <form action="{{ routes.cart_add_url }}" method="post" class="product-page__form" id="product-form">

          {% unless product.has_only_default_variant %}
            <div class="product-page__variants">
              {% for option in product.options_with_values %}
                <div class="product-option">
                  <label class="product-option__label">{{ option.name }}</label>
                  <div class="product-option__values">
                    {% for value in option.values %}
                      <button type="button"
                              class="product-option__value{% if forloop.first %} active{% endif %}"
                              data-option-position="{{ option.position }}"
                              data-option-value="{{ value }}">
                        {{ value }}
                      </button>
                    {% endfor %}
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endunless %}

          <input type="hidden" name="id" id="product-variant-id" value="{{ product.selected_or_first_available_variant.id }}">

          <div class="product-page__quantity">
            <label for="quantity">Cantidad:</label>
            <div class="quantity-selector">
              <button type="button" class="quantity-selector__btn" data-quantity-minus>-</button>
              <input type="number"
                     id="quantity"
                     name="quantity"
                     value="1"
                     min="1"
                     class="quantity-selector__input">
              <button type="button" class="quantity-selector__btn" data-quantity-plus>+</button>
            </div>
          </div>

          <button type="submit"
                  class="btn btn--primary btn--large btn--full-width"
                  id="add-to-cart-button"
                  {% unless product.available %}disabled{% endunless %}>
            {% if product.available %}
              Añadir al carrito
            {% else %}
              Agotado
            {% endif %}
          </button>
        </form>

        <!-- USPs -->
        <div class="product-page__usps">
          <div class="usp-item">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M10 0L12.09 6.26L19 7.27L14 12.14L15.18 19.02L10 15.77L4.82 19.02L6 12.14L1 7.27L7.91 6.26L10 0Z" fill="#5c899d"/>
            </svg>
            <span>Envío gratis en 24-48h</span>
          </div>
          <div class="usp-item">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M10 0L1 4V10C1 15.55 4.84 20.74 10 22C15.16 20.74 19 15.55 19 10V4L10 0Z" fill="#5c899d"/>
            </svg>
            <span>Garantía de 2 años</span>
          </div>
          <div class="usp-item">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M8 16L3 11L4.5 9.5L8 13L15.5 5.5L17 7L8 16Z" fill="#5c899d"/>
            </svg>
            <span>Devolución en 30 días</span>
          </div>
        </div>

        <!-- App blocks area for reviews, etc -->
        {% for block in section.blocks %}
          {% case block.type %}
            {% when '@app' %}
              {% render block %}
          {% endcase %}
        {% endfor %}

      </div>

    </div>
  </div>
</div>

<script>
  // Product variant selection
  (function() {
    const product = {{ product | json }};
    const variantIdInput = document.getElementById('product-variant-id');
    const priceElement = document.getElementById('product-price');
    const addToCartButton = document.getElementById('add-to-cart-button');
    const mainImage = document.getElementById('product-main-image');

    // Option buttons
    const optionButtons = document.querySelectorAll('.product-option__value');

    optionButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Update active state
        const siblings = this.parentElement.querySelectorAll('.product-option__value');
        siblings.forEach(sibling => sibling.classList.remove('active'));
        this.classList.add('active');

        // Get selected options
        const selectedOptions = [];
        document.querySelectorAll('.product-option').forEach(option => {
          const activeBtn = option.querySelector('.product-option__value.active');
          if (activeBtn) {
            selectedOptions.push(activeBtn.dataset.optionValue);
          }
        });

        // Find matching variant
        const variant = product.variants.find(v => {
          return selectedOptions.every((option, index) => {
            return v.options[index] === option;
          });
        });

        if (variant) {
          // Update variant ID
          variantIdInput.value = variant.id;

          // Update price
          priceElement.textContent = Shopify.formatMoney(variant.price);

          // Update availability
          if (variant.available) {
            addToCartButton.disabled = false;
            addToCartButton.textContent = 'Añadir al carrito';
          } else {
            addToCartButton.disabled = true;
            addToCartButton.textContent = 'Agotado';
          }

          // Update image if variant has one
          if (variant.featured_image) {
            mainImage.src = variant.featured_image.src.replace(/\.(jpg|jpeg|png|gif)/, '_1000x.$1');
          }
        }
      });
    });

    // Thumbnail navigation
    const thumbnails = document.querySelectorAll('.product-page__thumbnail');
    thumbnails.forEach(thumbnail => {
      thumbnail.addEventListener('click', function() {
        thumbnails.forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        mainImage.src = this.dataset.imageSrc;
      });
    });
  })();
</script>

<style>
  .product-page {
    padding: 120px 0 var(--spacing-xl);
  }

  .product-page__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--spacing-lg);
  }

  @media (min-width: 1024px) {
    .product-page__grid {
      grid-template-columns: 1fr 1fr;
    }
  }

  .product-page__main-image {
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-md);
    margin-bottom: var(--spacing-sm);
  }

  .product-page__main-image img {
    width: 100%;
    height: auto;
  }

  .product-page__thumbnails {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: var(--spacing-sm);
  }

  .product-page__thumbnail {
    border-radius: var(--radius-sm);
    overflow: hidden;
    border: 2px solid transparent;
    cursor: pointer;
    transition: var(--transition);
  }

  .product-page__thumbnail.active {
    border-color: var(--color-primary);
  }

  .product-page__thumbnail img {
    width: 100%;
    height: auto;
    display: block;
  }

  .product-page__price {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    margin: var(--spacing-md) 0;
  }

  .product-page__price-current {
    font-size: 2.5rem;
    font-weight: 700;
    font-family: var(--font-heading);
    color: var(--color-dark);
  }

  .product-page__price-compare {
    font-size: 1.5rem;
    color: var(--color-text-light);
    text-decoration: line-through;
  }

  .product-page__description {
    margin-bottom: var(--spacing-md);
  }

  .product-page__variants {
    margin-bottom: var(--spacing-md);
  }

  .product-page__quantity {
    margin-bottom: var(--spacing-md);
  }

  .product-page__quantity label {
    display: block;
    font-weight: 600;
    margin-bottom: var(--spacing-xs);
  }

  .product-page__usps {
    margin-top: var(--spacing-md);
    padding-top: var(--spacing-md);
    border-top: 1px solid #eee;
  }
</style>

{% schema %}
{
  "name": "Product Information",
  "settings": [],
  "blocks": [
    {
      "type": "@app"
    }
  ]
}
{% endschema %}
